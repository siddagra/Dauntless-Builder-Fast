var greenLight=!1,filtSetCells=[],filtSet=[];const iweapon=[[{id:114,cell:[2,4],perk:{j:1,k:3}},{id:115,cell:[3,4],perk:{j:2,k:0}},{id:117,cell:[1,3],perk:{j:1,k:6}},{id:229,cell:[2,3],perk:{j:4,k:9}},{id:199,cell:[5,1],perk:{j:5,k:2}},{id:113,cell:[3,1],perk:{j:1,k:3}},{id:216,cell:[4,5],perk:{j:3,k:4}},{id:219,cell:[2,4],perk:{j:5,k:1}},{id:111,cell:[3,2],perk:{j:3,k:2}},{id:122,cell:[3,5],perk:{j:3,k:2}},{id:118,cell:[2,2],perk:{j:2,k:6}},{id:119,cell:[3,1],perk:{j:2,k:2}},{id:120,cell:[3,5],perk:{j:3,k:12}},{id:121,cell:[3,4],perk:{j:2,k:5}},{id:110,cell:[3,4],perk:{j:3,k:0}},{id:108,cell:[3,5],perk:{j:2,k:10}},{id:206,cell:[3,3],perk:{j:3,k:8}},{id:123,cell:[3,4],perk:{j:2,k:5}},{id:109,cell:[2,5],perk:{j:2,k:12}},{id:112,cell:[3,5],perk:{j:1,k:2}},{id:125,cell:[3,1],perk:{j:5,k:1}},{id:167,cell:[2,3],perk:{j:5,k:2}},{id:232,cell:[1,3],perk:{j:2,k:2}},{id:116,cell:[3,2],perk:{j:5,k:1}},{id:126,cell:[2,5],perk:{j:2,k:0}},{id:124,cell:[3,1],perk:{j:1,k:11}}],[{id:163,cell:[2,3],perk:{j:5,k:2}},{id:196,cell:[5,1],perk:{j:5,k:2}},{id:7,cell:[2,4],perk:{j:2,k:0}},{id:66,cell:[1,2],perk:{j:3,k:2}},{id:21,cell:[2,1],perk:{j:1,k:6}},{id:227,cell:[3,2],perk:{j:4,k:9}},{id:212,cell:[5,4],perk:{j:3,k:4}},{id:217,cell:[2,4],perk:{j:5,k:1}},{id:36,cell:[2,2],perk:{j:2,k:6}},{id:39,cell:[2,3],perk:{j:2,k:3}},{id:53,cell:[2,5],perk:{j:3,k:12}},{id:56,cell:[2,4],perk:{j:2,k:5}},{id:60,cell:[2,4],perk:{j:3,k:0}},{id:29,cell:[2,5],perk:{j:2,k:10}},{id:83,cell:[2,5],perk:{j:3,k:2}},{id:204,cell:[3,3],perk:{j:3,k:8}},{id:86,cell:[2,4],perk:{j:2,k:5}},{id:79,cell:[2,1],perk:{j:1,k:3}},{id:48,cell:[2,5],perk:{j:2,k:12}},{id:70,cell:[3,5],perk:{j:1,k:2}},{id:97,cell:[2,1],perk:{j:5,k:7}},{id:15,cell:[2,4],perk:{j:5,k:1}},{id:5,cell:[2,4],perk:{j:1,k:3}},{id:102,cell:[2,5],perk:{j:2,k:0}},{id:91,cell:[2,1],perk:{j:1,k:11}}],[{id:6,cell:[3,4],perk:{j:2,k:0}},{id:164,cell:[2,3],perk:{j:5,k:2}},{id:2,cell:[2,4],perk:{j:1,k:3}},{id:17,cell:[3,1],perk:{j:1,k:6}},{id:80,cell:[3,5],perk:{j:3,k:2}},{id:67,cell:[3,2],perk:{j:3,k:2}},{id:228,cell:[3,2],perk:{j:4,k:9}},{id:77,cell:[3,1],perk:{j:1,k:3}},{id:214,cell:[5,4],perk:{j:3,k:4}},{id:218,cell:[2,4],perk:{j:5,k:1}},{id:37,cell:[2,2],perk:{j:2,k:6}},{id:43,cell:[3,1],perk:{j:2,k:2}},{id:52,cell:[3,5],perk:{j:3,k:1}},{id:55,cell:[3,4],perk:{j:2,k:15}},{id:59,cell:[3,4],perk:{j:3,k:0}},{id:33,cell:[3,5],perk:{j:2,k:10}},{id:209,cell:[3,3],perk:{j:3,k:8}},{id:87,cell:[3,4],perk:{j:2,k:15}},{id:45,cell:[2,5],perk:{j:2,k:12}},{id:74,cell:[3,5],perk:{j:1,k:2}},{id:96,cell:[3,1],perk:{j:5,k:7}},{id:202,cell:[5,1],perk:{j:5,k:2}},{id:13,cell:[3,2],perk:{j:5,k:1}},{id:105,cell:[2,5],perk:{j:2,k:0}},{id:95,cell:[3,1],perk:{j:1,k:11}}],[{id:64,cell:[2,1],perk:{j:3,k:2}},{id:1,cell:[2,4],perk:{j:1,k:3}},{id:8,cell:[2,4],perk:{j:2,k:0}},{id:19,cell:[2,1],perk:{j:1,k:6}},{id:81,cell:[2,5],perk:{j:3,k:2}},{id:76,cell:[2,1],perk:{j:1,k:3}},{id:230,cell:[3,2],perk:{j:4,k:9}},{id:215,cell:[5,4],perk:{j:3,k:4}},{id:221,cell:[2,4],perk:{j:5,k:1}},{id:35,cell:[2,2],perk:{j:2,k:6}},{id:40,cell:[2,3],perk:{j:2,k:3}},{id:11,cell:[-1,2],perk:{j:2,k:1}},{id:49,cell:[2,5],perk:{j:3,k:12}},{id:57,cell:[2,4],perk:{j:2,k:5}},{id:62,cell:[2,4],perk:{j:3,k:0}},{id:200,cell:[5,1],perk:{j:5,k:2}},{id:31,cell:[2,5],perk:{j:2,k:10}},{id:208,cell:[3,3],perk:{j:3,k:8}},{id:90,cell:[2,4],perk:{j:2,k:5}},{id:166,cell:[2,3],perk:{j:5,k:2}},{id:44,cell:[2,5],perk:{j:2,k:12}},{id:71,cell:[3,5],perk:{j:1,k:2}},{id:98,cell:[2,1],perk:{j:5,k:1}},{id:14,cell:[2,4],perk:{j:5,k:1}},{id:101,cell:[2,5],perk:{j:2,k:0}},{id:93,cell:[2,1],perk:{j:1,k:11}}],[{id:172,cell:[2,4],perk:{j:2,k:0}},{id:184,cell:[3,5],perk:{j:3,k:2}},{id:175,cell:[3,1],perk:{j:1,k:6}},{id:197,cell:[5,1],perk:{j:5,k:2}},{id:186,cell:[3,1],perk:{j:1,k:3}},{id:226,cell:[3,2],perk:{j:4,k:9}},{id:211,cell:[5,4],perk:{j:3,k:4}},{id:187,cell:[2,5],perk:{j:3,k:2}},{id:222,cell:[2,4],perk:{j:5,k:1}},{id:177,cell:[2,2],perk:{j:2,k:6}},{id:178,cell:[3,1],perk:{j:2,k:2}},{id:181,cell:[3,5],perk:{j:3,k:12}},{id:182,cell:[3,1],perk:{j:2,k:15}},{id:183,cell:[2,4],perk:{j:3,k:0}},{id:176,cell:[3,5],perk:{j:2,k:10}},{id:203,cell:[3,3],perk:{j:3,k:8}},{id:188,cell:[2,4],perk:{j:2,k:15}},{id:179,cell:[2,5],perk:{j:2,k:12}},{id:185,cell:[3,5],perk:{j:1,k:2}},{id:190,cell:[2,1],perk:{j:5,k:1}},{id:106,cell:[-1,3],perk:{j:1,k:6}},{id:192,cell:[2,3],perk:{j:5,k:2}},{id:174,cell:[3,4],perk:{j:5,k:1}},{id:195,cell:[2,5],perk:{j:2,k:0}},{id:171,cell:[2,4],perk:{j:1,k:3}},{id:189,cell:[3,1],perk:{j:1,k:11}}],[{id:65,cell:[3,5],perk:{j:3,k:2}},{id:9,cell:[2,4],perk:{j:2,k:0}},{id:75,cell:[1,1],perk:{j:1,k:3}},{id:18,cell:[3,1],perk:{j:1,k:6}},{id:224,cell:[3,2],perk:{j:4,k:9}},{id:210,cell:[5,4],perk:{j:3,k:4}},{id:220,cell:[2,4],perk:{j:5,k:1}},{id:38,cell:[2,2],perk:{j:2,k:6}},{id:41,cell:[3,1],perk:{j:2,k:2}},{id:51,cell:[5,1],perk:{j:3,k:1}},{id:3,cell:[2,4],perk:{j:1,k:3}},{id:54,cell:[2,4],perk:{j:2,k:5}},{id:63,cell:[3,4],perk:{j:3,k:0}},{id:30,cell:[5,4],perk:{j:2,k:10}},{id:205,cell:[3,3],perk:{j:3,k:8}},{id:201,cell:[5,1],perk:{j:5,k:2}},{id:231,cell:[4,2],perk:{j:4,k:6}},{id:88,cell:[2,4],perk:{j:2,k:5}},{id:47,cell:[2,5],perk:{j:2,k:12}},{id:73,cell:[3,5],perk:{j:1,k:2}},{id:100,cell:[3,1],perk:{j:5,k:7}},{id:168,cell:[2,3],perk:{j:5,k:2}},{id:84,cell:[2,-1],perk:{j:2,k:10}},{id:12,cell:[2,5],perk:{j:5,k:1}},{id:104,cell:[2,5],perk:{j:2,k:0}},{id:85,cell:[2,5],perk:{j:3,k:2}},{id:92,cell:[3,1],perk:{j:1,k:11}}],[{id:10,cell:[3,4],perk:{j:2,k:0}},{id:20,cell:[3,1],perk:{j:1,k:6}},{id:198,cell:[5,1],perk:{j:5,k:2}},{id:225,cell:[3,2],perk:{j:4,k:9}},{id:213,cell:[5,4],perk:{j:3,k:4}},{id:223,cell:[2,4],perk:{j:5,k:1}},{id:82,cell:[3,5],perk:{j:3,k:2}},{id:34,cell:[2,2],perk:{j:2,k:6}},{id:165,cell:[2,3],perk:{j:5,k:2}},{id:42,cell:[3,1],perk:{j:2,k:2}},{id:50,cell:[3,5],perk:{j:3,k:1}},{id:58,cell:[3,4],perk:{j:2,k:15}},{id:61,cell:[3,4],perk:{j:3,k:0}},{id:32,cell:[3,5],perk:{j:2,k:10}},{id:4,cell:[2,4],perk:{j:1,k:3}},{id:207,cell:[3,3],perk:{j:3,k:8}},{id:78,cell:[3,1],perk:{j:1,k:3}},{id:89,cell:[3,4],perk:{j:2,k:15}},{id:46,cell:[2,5],perk:{j:2,k:12}},{id:68,cell:[3,2],perk:{j:3,k:2}},{id:72,cell:[3,5],perk:{j:1,k:2}},{id:99,cell:[3,1],perk:{j:5,k:7}},{id:69,cell:[2,-1],perk:{j:3,k:12}},{id:16,cell:[3,2],perk:{j:5,k:1}},{id:103,cell:[2,5],perk:{j:2,k:0}},{id:94,cell:[3,1],perk:{j:1,k:11}}],[{id:12777,cell:[-1,2],perk:{j:0,k:0}},{id:12777,cell:[-1,3],perk:{j:0,k:0}},{id:12777,cell:[1,1],perk:{j:0,k:0}},{id:12777,cell:[1,2],perk:{j:0,k:0}},{id:12777,cell:[1,3],perk:{j:0,k:0}},{id:12777,cell:[2,2],perk:{j:0,k:0}},{id:12777,cell:[2,3],perk:{j:0,k:0}},{id:12777,cell:[2,4],perk:{j:0,k:0}},{id:12777,cell:[2,5],perk:{j:0,k:0}},{id:12777,cell:[3,3],perk:{j:0,k:0}},{id:12777,cell:[3,4],perk:{j:0,k:0}},{id:12777,cell:[3,5],perk:{j:0,k:0}},{id:12777,cell:[4,5],perk:{j:0,k:0}},{id:12777,cell:[5,1],perk:{j:0,k:0}}]],iarmor=[[{id:101,cell:5,perk:{j:5,k:3}},{id:98,cell:4,perk:{j:4,k:9}},{id:123,cell:5,perk:{j:3,k:13}},{id:1,cell:5,perk:{j:1,k:3}},{id:43,cell:2,perk:{j:2,k:5}},{id:105,cell:2,perk:{j:5,k:16}},{id:81,cell:2,perk:{j:5,k:9}},{id:66,cell:2,perk:{j:3,k:2}},{id:12,cell:2,perk:{j:5,k:1}},{id:32,cell:1,perk:{j:1,k:2}},{id:17,cell:1,perk:{j:1,k:6}},{id:22,cell:4,perk:{j:2,k:14}},{id:55,cell:5,perk:{j:5,k:1}},{id:27,cell:3,perk:{j:2,k:10}},{id:50,cell:3,perk:{j:5,k:5}},{id:78,cell:3,perk:{j:5,k:7}},{id:86,cell:1,perk:{j:1,k:8}},{id:118,cell:1,perk:{j:5,k:13}},{id:54,cell:3,perk:{j:5,k:10}},{id:49,cell:4,perk:{j:3,k:12}},{id:21,cell:0,perk:{j:0,k:0}},{id:38,cell:5,perk:{j:5,k:10}},{id:61,cell:3,perk:{j:1,k:5}},{id:71,cell:4,perk:{j:4,k:14}},{id:74,cell:1,perk:{j:1,k:7}},{id:130,cell:1,perk:{j:1,k:10}},{id:135,cell:5,perk:{j:4,k:12}},{id:5,cell:4,perk:{j:5,k:12}},{id:94,cell:5,perk:{j:5,k:4}},{id:112,cell:3,perk:{j:2,k:12}},{id:109,cell:3,perk:{j:3,k:7}},{id:88,cell:5,perk:{j:5,k:16}},{id:67,cell:2,perk:{j:2,k:9}},{id:37,cell:3,perk:{j:1,k:1}},{id:8,cell:4,perk:{j:4,k:13}},{id:125,cell:2,perk:{j:4,k:0}},{id:12777,cell:0,perk:{j:0,k:0}},{id:12777,cell:1,perk:{j:0,k:0}},{id:12777,cell:2,perk:{j:0,k:0}},{id:12777,cell:3,perk:{j:0,k:0}},{id:12777,cell:4,perk:{j:0,k:0}},{id:12777,cell:5,perk:{j:0,k:0}}],[{id:102,cell:1,perk:{j:5,k:3}},{id:80,cell:2,perk:{j:4,k:8}},{id:96,cell:5,perk:{j:4,k:9}},{id:122,cell:1,perk:{j:3,k:13}},{id:4,cell:4,perk:{j:2,k:9}},{id:106,cell:3,perk:{j:1,k:8}},{id:44,cell:2,perk:{j:4,k:5}},{id:64,cell:2,perk:{j:2,k:9}},{id:13,cell:2,perk:{j:5,k:1}},{id:14,cell:1,perk:{j:1,k:6}},{id:23,cell:4,perk:{j:4,k:14}},{id:68,cell:4,perk:{j:4,k:6}},{id:28,cell:3,perk:{j:5,k:12}},{id:52,cell:5,perk:{j:3,k:2}},{id:79,cell:1,perk:{j:5,k:7}},{id:87,cell:3,perk:{j:2,k:0}},{id:35,cell:5,perk:{j:3,k:7}},{id:57,cell:5,perk:{j:5,k:5}},{id:119,cell:4,perk:{j:4,k:9}},{id:48,cell:3,perk:{j:3,k:12}},{id:18,cell:0,perk:{j:0,k:0}},{id:33,cell:3,perk:{j:2,k:2}},{id:40,cell:4,perk:{j:5,k:10}},{id:62,cell:1,perk:{j:1,k:5}},{id:75,cell:1,perk:{j:1,k:0}},{id:131,cell:4,perk:{j:3,k:4}},{id:133,cell:3,perk:{j:5,k:8}},{id:95,cell:3,perk:{j:3,k:2}},{id:113,cell:5,perk:{j:5,k:2}},{id:111,cell:2,perk:{j:2,k:6}},{id:90,cell:2,perk:{j:2,k:5}},{id:6,cell:5,perk:{j:2,k:0}},{id:127,cell:4,perk:{j:4,k:0}},{id:12777,cell:0,perk:{j:0,k:0}},{id:12777,cell:1,perk:{j:0,k:0}},{id:12777,cell:2,perk:{j:0,k:0}},{id:12777,cell:3,perk:{j:0,k:0}},{id:12777,cell:4,perk:{j:0,k:0}},{id:12777,cell:5,perk:{j:0,k:0}}],[{id:103,cell:3,perk:{j:5,k:2}},{id:97,cell:4,perk:{j:4,k:13}},{id:42,cell:4,perk:{j:2,k:5}},{id:121,cell:1,perk:{j:3,k:10}},{id:3,cell:2,perk:{j:2,k:14}},{id:104,cell:4,perk:{j:3,k:8}},{id:30,cell:1,perk:{j:1,k:3}},{id:63,cell:5,perk:{j:5,k:10}},{id:10,cell:5,perk:{j:2,k:12}},{id:15,cell:3,perk:{j:1,k:4}},{id:82,cell:4,perk:{j:5,k:9}},{id:24,cell:2,perk:{j:2,k:10}},{id:34,cell:2,perk:{j:1,k:6}},{id:56,cell:1,perk:{j:1,k:5}},{id:26,cell:2,perk:{j:5,k:12}},{id:51,cell:3,perk:{j:5,k:5}},{id:77,cell:1,perk:{j:5,k:4}},{id:84,cell:3,perk:{j:3,k:7}},{id:69,cell:4,perk:{j:4,k:5}},{id:116,cell:5,perk:{j:5,k:13}},{id:47,cell:3,perk:{j:3,k:1}},{id:19,cell:0,perk:{j:0,k:0}},{id:39,cell:5,perk:{j:5,k:1}},{id:59,cell:1,perk:{j:2,k:15}},{id:73,cell:1,perk:{j:5,k:2}},{id:129,cell:5,perk:{j:1,k:10}},{id:134,cell:3,perk:{j:3,k:11}},{id:92,cell:2,perk:{j:4,k:8}},{id:114,cell:2,perk:{j:5,k:16}},{id:108,cell:3,perk:{j:2,k:6}},{id:89,cell:2,perk:{j:2,k:6}},{id:7,cell:5,perk:{j:2,k:9}},{id:124,cell:4,perk:{j:3,k:4}},{id:12777,cell:0,perk:{j:0,k:0}},{id:12777,cell:1,perk:{j:0,k:0}},{id:12777,cell:2,perk:{j:0,k:0}},{id:12777,cell:3,perk:{j:0,k:0}},{id:12777,cell:4,perk:{j:0,k:0}},{id:12777,cell:5,perk:{j:0,k:0}}],[{id:100,cell:5,perk:{j:4,k:6}},{id:99,cell:4,perk:{j:4,k:5}},{id:120,cell:3,perk:{j:1,k:2}},{id:2,cell:3,perk:{j:2,k:14}},{id:107,cell:3,perk:{j:3,k:8}},{id:31,cell:2,perk:{j:1,k:3}},{id:65,cell:5,perk:{j:4,k:8}},{id:11,cell:5,perk:{j:1,k:7}},{id:45,cell:4,perk:{j:2,k:6}},{id:16,cell:4,perk:{j:1,k:5}},{id:25,cell:2,perk:{j:4,k:14}},{id:83,cell:5,perk:{j:2,k:0}},{id:29,cell:2,perk:{j:4,k:5}},{id:53,cell:1,perk:{j:1,k:1}},{id:76,cell:1,perk:{j:5,k:2}},{id:85,cell:3,perk:{j:2,k:0}},{id:117,cell:1,perk:{j:1,k:7}},{id:70,cell:4,perk:{j:4,k:6}},{id:46,cell:3,perk:{j:3,k:1}},{id:20,cell:0,perk:{j:0,k:0}},{id:41,cell:4,perk:{j:5,k:7}},{id:60,cell:1,perk:{j:1,k:8}},{id:72,cell:5,perk:{j:1,k:0}},{id:128,cell:4,perk:{j:1,k:15}},{id:132,cell:1,perk:{j:4,k:12}},{id:36,cell:5,perk:{j:3,k:7}},{id:58,cell:1,perk:{j:5,k:5}},{id:93,cell:3,perk:{j:3,k:2}},{id:115,cell:3,perk:{j:5,k:16}},{id:110,cell:2,perk:{j:5,k:4}},{id:91,cell:2,perk:{j:2,k:5}},{id:9,cell:2,perk:{j:2,k:14}},{id:126,cell:2,perk:{j:5,k:3}},{id:12777,cell:0,perk:{j:0,k:0}},{id:12777,cell:1,perk:{j:0,k:0}},{id:12777,cell:2,perk:{j:0,k:0}},{id:12777,cell:3,perk:{j:0,k:0}},{id:12777,cell:4,perk:{j:0,k:0}},{id:12777,cell:5,perk:{j:0,k:0}}]],perkListLengths=[1,16,16,14,18,17];function GreenLight(){var e=[];if(0==greenLight){for(j=1;j<perkListLengths.length;j++)for(k=0;k<perkListLengths[j];k++)e.push({j:j,k:k,value:2});greenLight=!0,this.postMessage({bonusPerks:e})}}const sortMatrix=(e,l)=>{for(let k=0;k<e.length;++k){if(e[k]<l[k])return-1;if(e[k]>l[k])return 1}return 0};function indexOfPerk(e,l){let k=l.length;for(let r=0;r<k;r++)if(e.k==l[r].k&&e.j==l[r].j)return r;return-1}var lock=[];function checkLockbyID(e,l){for(let k=0;k<lock[l].length;k++)if(e.id==lock[l][k])return!0;return!1}function search(l,r){const p=[1,16,16,14,18,17];var t=[],o=[],n=[0,0,0,0,0,0],f=[];let m=0;for(let e=lock.length-1;e>=0;e--)-1==lock[e]&&m++,f.unshift(m);m=0;var s=[],S=[],g=[],u=[!1,!1,!1];filtSet=[];n=[0,0,0,0,0,0];var L=[0,0,0,0,0],w=0,y=0,T=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],x=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];tempperk=[];var C=iweapon.length;for(i=0;i<C;i++)s.push(iweapon[i].length);var P=iarmor.length;for(i=0;i<P;i++)S.push(iarmor[i].length);for(i=0;i<P;i++)o.push([]),u.push(!1);var v=l.length;for(j=0;j<C;j++)for(k=0;k<s[j];k++)12777==iweapon[j][k].id&&t.push({e:j,f:k});for(j=0;j<P;j++)for(k=0;k<S[j];k++)12777==iarmor[j][k].id&&o[j].push(k);for(h=0;h<v;h++){for(j=0;j<C;j++)for(k=0;k<s[j];k++)iweapon[j][k].perk.j==l[h].j&&iweapon[j][k].perk.k==l[h].k&&t.push({e:j,f:k});for(j=0;j<P;j++)for(k=0;k<S[j];k++)iarmor[j][k].perk.j==l[h].j&&iarmor[j][k].perk.k==l[h].k&&o[j].push(k)}if(-1!=lock[0]&&null!=lock[0]){t.splice(0);for(let e=0;e<s[lock[0]];e++)t.push({e:lock[0],f:e})}-1!=lock[1]&&null!=lock[1]&&(t.splice(0),t.push({e:lock[1].j,f:lock[1].k}));for(let e=2;e<lock.length;e++)-1!=lock[e]&&null!=lock[e]&&(o[e-2].splice(0),o[e-2].push(lock[e].k));r.slice();var W=t.length;for(i=0;i<P;i++)g.push(o[i].length);for(i=0;i<r.length;i++)y+=r[i];for(w=12-y,i=0;i<v;i++)n[l[i].j]+=r[i];for(n[5]>0&&(n[5]--,w++),i=0;i<r.length;i++)tempperk.push(r[i]);for(this.console.time("search"),w>11&&f[0]>2&&GreenLight(),e=0;e<W;e++){for(L[4]=w,h=0;h<v;h++){if(iweapon[t[e].e][t[e].f].perk.k==l[h].k&&iweapon[t[e].e][t[e].f].perk.j==l[h].j){n[l[h].j]>0&&tempperk[h]>0&&w++,n[l[h].j]--,tempperk[h]--,x[4]=l[h].j,T[4]=h;break}x[4]=0,T[4]=20}if(legendaryWeapon||((n[iweapon[t[e].e][t[e].f].cell[0]]>0||-1==iweapon[t[e].e][t[e].f].cell[0])&&w++,n[iweapon[t[e].e][t[e].f].cell[0]]--,n[iweapon[t[e].e][t[e].f].cell[1]]>0&&w++,n[iweapon[t[e].e][t[e].f].cell[1]]--),legendaryWeapon&&(w+=2),0==greenLight&&w>11&&f[1]>2&&GreenLight(),w>3)for(a=0;a<g[0];a++){for(L[0]=w,h=0;h<v;h++){if(iarmor[0][o[0][a]].perk.k==l[h].k&&iarmor[0][o[0][a]].perk.j==l[h].j){n[l[h].j]>0&&tempperk[h]>0&&w++,n[l[h].j]--,tempperk[h]--,x[0]=l[h].j,T[0]=h;break}x[0]=0,T[0]=20}if(n[iarmor[0][o[0][a]].cell]>0&&w++,n[iarmor[0][o[0][a]].cell]--,0==greenLight&&w>11&&f[2]>2&&GreenLight(),w>5)for(b=0;b<g[1];b++){for(L[1]=w,h=0;h<v;h++){if(iarmor[1][o[1][b]].perk.k==l[h].k&&iarmor[1][o[1][b]].perk.j==l[h].j){n[l[h].j]>0&&tempperk[h]>0&&w++,n[l[h].j]--,tempperk[h]--,x[1]=l[h].j,T[1]=h;break}x[1]=0,T[1]=20}if(n[iarmor[1][o[1][b]].cell]>0&&w++,n[iarmor[1][o[1][b]].cell]--,0==greenLight&&w>11&&f[3]>2&&GreenLight(),w>7)for(L[2]=w,c=0;c<g[2];c++){for(h=0;h<v;h++){if(iarmor[2][o[2][c]].perk.k==l[h].k&&iarmor[2][o[2][c]].perk.j==l[h].j){n[l[h].j]>0&&tempperk[h]>0&&w++,n[l[h].j]--,tempperk[h]--,x[2]=l[h].j,T[2]=h;break}x[2]=0,T[2]=20}if(n[iarmor[2][o[2][c]].cell]>0&&w++,n[iarmor[2][o[2][c]].cell]--,w>9)for(L[3]=w,d=0;d<g[3];d++){for(h=0;h<v;h++){if(iarmor[3][o[3][d]].perk.k==l[h].k&&iarmor[3][o[3][d]].perk.j==l[h].j){n[l[h].j]>0&&tempperk[h]>0&&w++,n[l[h].j]--,tempperk[h]--,x[3]=l[h].j,T[3]=h;break}x[3]=0,T[3]=20}n[iarmor[3][o[3][d]].cell]>0&&w++,n[iarmor[3][o[3][d]].cell]--,w>11&&(filtSet.push([o[0][a],o[1][b],o[2][c],o[3][d],t[e].e,t[e].f]),0),w=L[3],0!=x[3]&&n[x[3]]++,n[iarmor[3][o[3][d]].cell]++,20!=T[3]&&tempperk[T[3]]++}w=L[2],0!=x[2]&&n[x[2]]++,n[iarmor[2][o[2][c]].cell]++,20!=T[2]&&tempperk[T[2]]++}w=L[1],0!=x[1]&&n[x[1]]++,n[iarmor[1][o[1][b]].cell]++,20!=T[1]&&tempperk[T[1]]++}w=L[0],0!=x[0]&&n[x[0]]++,n[iarmor[0][o[0][a]].cell]++,20!=T[0]&&tempperk[T[0]]++}w=L[4],0!=x[4]&&n[x[4]]++,legendaryWeapon||(n[iweapon[t[e].e][t[e].f].cell[0]]++,n[iweapon[t[e].e][t[e].f].cell[1]]++),20!=T[4]&&tempperk[T[4]]++}filtSet=filtSet.sort(sortMatrix),this.console.timeEnd("search");var M,R=[],E=[],F=[],G=[],O=filtSet.length,D=[],I=P+3,q=p.length;for(i=0;i<I;i++)D.push(!1),E.push(0);for(i=0;i<q;i++)R.push(0);for(i=0;i<v;i++)tempperk[i]=r[i];if(0==greenLight){for(j=1;j<p.length;j++)for(k=0;k<p[j];k++)F.push({j:j,k:k,value:0});for(let e=0;e<O;e++){for(filtSetCells.push([]),G=[],M=[],j=0;j<I;j++)filtSetCells[e].push({j:0,k:0}),D[j]=!1,E[j]=0;for(h=0;h<v;h++)tempperk[h]=r[h];for(h=0;h<v;h++)for(iweapon[filtSet[e][P]][filtSet[e][P+1]].perk.k==l[h].k&&iweapon[filtSet[e][P]][filtSet[e][P+1]].perk.j==l[h].j&&tempperk[h]--,j=0;j<P;j++)iarmor[j][filtSet[e][j]].perk.k==l[h].k&&iarmor[j][filtSet[e][j]].perk.j==l[h].j&&tempperk[h]--;for(h=0;h<v;h++){for(j=0;j<P;j++)iarmor[j][filtSet[e][j]].cell==l[h].j&&tempperk[h]>0&&0==D[j]&&(filtSetCells[e][j].j=l[h].j,filtSetCells[e][j].k=l[h].k,D[j]=!0,tempperk[h]--);5==l[h].j&&tempperk[h]>0&&0==D[P+2]&&(filtSetCells[e][P+2].j=l[h].j,filtSetCells[e][P+2].k=l[h].k,D[P+2]=!0,tempperk[h]--),legendaryWeapon?(tempperk[h]>0&&0==D[P]&&(filtSetCells[e][P].j=l[h].j,filtSetCells[e][P].k=l[h].k,D[P]=!0,tempperk[h]--),tempperk[h]>0&&0==D[P+1]&&(filtSetCells[e][P+1].j=l[h].j,filtSetCells[e][P+1].k=l[h].k,D[P+1]=!0,tempperk[h]--)):(iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[1]==l[h].j&&tempperk[h]>0&&0==D[P+1]&&(filtSetCells[e][P+1].j=l[h].j,filtSetCells[e][P+1].k=l[h].k,D[P+1]=!0,tempperk[h]--),(iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0]==l[h].j||-1==iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0])&&tempperk[h]>0&&0==D[P]&&(filtSetCells[e][P].j=l[h].j,filtSetCells[e][P].k=l[h].k,D[P]=!0,tempperk[h]--))}for(j=0;j<P;j++)0==D[j]&&(E[iarmor[j][filtSet[e][j]].cell]++,R[iarmor[j][filtSet[e][j]].cell]<E[iarmor[j][filtSet[e][j]].cell]&&(R[iarmor[j][filtSet[e][j]].cell]=E[iarmor[j][filtSet[e][j]].cell]));if(legendaryWeapon){if(0==D[P+1]&&0==D[P])for(let e=1;e<p.length;e++)E[e]+=2,R[e]<E[e]&&(R[e]=E[e]);else if(0==D[P+1]||0==D[P])for(let e=1;e<p.length;e++)E[e]++,R[e]<E[e]&&(R[e]=E[e])}else 0==D[P]&&(E[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0]]++,R[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0]]<E[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0]]&&(R[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0]]=E[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0]])),0==D[P+1]&&(E[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[1]]++,R[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[1]]<E[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[1]]&&(R[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[1]]=E[iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[1]]));for(0==D[P+2]&&(E[5]++,E[5]>R[5]&&(R[5]=E[5])),j=0;j<P;j++)if(12777==iarmor[j][filtSet[e][j]].id)for(k=0;k<S[j];k++)iarmor[j][k].cell==iarmor[j][filtSet[e][j]].cell&&0!=iarmor[j][k].perk.j&&0!=iarmor[j][k].perk.k&&G.push([iarmor[j][k].perk.j,iarmor[j][k].perk.k,j]);else G.push([iarmor[j][filtSet[e][j]].perk.j,iarmor[j][filtSet[e][j]].perk.k,j]);if(12777==iweapon[filtSet[e][P]][filtSet[e][P+1]].id)for(j=0;j<C;j++)for(k=0;k<s[j];k++)(iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0]==iweapon[j][k].cell[0]&&iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[1]==iweapon[j][k].cell[1]||iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[1]==iweapon[j][k].cell[0]&&iweapon[filtSet[e][P]][filtSet[e][P+1]].cell[0]==iweapon[j][k].cell[1])&&0!=iweapon[j][k].perk.j&&0!=iweapon[j][k].perk.k&&G.push([iweapon[j][k].perk.j,iweapon[j][k].perk.k,5]);else G.push([iweapon[filtSet[e][P]][filtSet[e][P+1]].perk.j,iweapon[filtSet[e][P]][filtSet[e][P+1]].perk.k,5]);G.sort(sortMatrix);let i=G.length,t=G.length-1;if(null!=G[0]){let e=-1;for(j=0;j<i;j++)if(j<t&&G[j][1]==G[j+1][1]&&G[j][0]==G[j+1][0]&&G[j+1][2]!=G[j][2]?(M.push({j:G[j][0],k:G[j][1],value:2}),j++,e++):(M.push({j:G[j][0],k:G[j][1],value:1}),M[++e].value+=E[M[e].j]),0!=M[e].j&&0!=M[e].k){let l=indexOfPerk(M[e],F);F[l].value<M[e].value&&(F[l].value=M[e].value)}}}var z=[];let e=0;for(F.length;e<F.length;e++)F[e].value<R[F[e].j]&&(F[e].value=R[F[e].j]),z.push({j:F[e].j,k:F[e].k,value:F[e].value});this.postMessage({bonusPerks:z})}}function ExpandfiltSetelem(e,l){let k,r=[],i=e.length;if(l==armorTypeLength)for(let l=0;l<i;l++)for(let i=0;i<weaponTypeLength;i++)for(let p=0;p<weaponLength[i];p++)(iweapon[i][p].cell[0]==iweapon[e[l][armorTypeLength]][e[l][armorTypeLength+1]].cell[0]&&iweapon[i][p].cell[1]==iweapon[e[l][armorTypeLength]][e[l][armorTypeLength+1]].cell[1]||iweapon[i][p].cell[1]==iweapon[e[l][armorTypeLength]][e[l][armorTypeLength+1]].cell[0]&&iweapon[i][p].cell[0]==iweapon[e[l][armorTypeLength]][e[l][armorTypeLength+1]].cell[1])&&12777!=iweapon[i][p].id&&((k=e[l].slice())[armorTypeLength]=i,k[armorTypeLength+1]=p,r.push(k));else for(let p=0;p<i;p++)for(let i=0;i<armorLength[l];i++)iarmor[l][e[p][l]].cell==iarmor[l][i].cell&&12777!=iarmor[l][i].id&&((k=e[p].slice())[l]=i,r.push(k));return r}function ExpandRecursivefiltSetelem(e,l){let k=l.length,r=ExpandfiltSetelem(e,l[0]);for(let e=1;e<k;e++)r=ExpandfiltSetelem(r,l[e]);return r}const sortFunction=(e,l)=>{let k=e.length;for(let r=0;r<k;r++)return e[r]<l[r]?-1:1;return 0};function processFiltSetelem(e){let l=[],k=[],r=!0;if(1==greenLight){for(filtSetCells.push([]),tempbonusPerkMat=[],tempbonusPerk=[],j=0;j<setWidth;j++)filtSetCells[e].push({j:0,k:0}),l[j]=!1;for(h=0;h<indexPerkLength;h++)tempperk[h]=indexPerkRank[h];for(h=0;h<indexPerkLength;h++)for(iweapon[filtSet[e][armorTypeLength]][filtSet[e][armorTypeLength+1]].perk.k==indexPerk[h].k&&iweapon[filtSet[e][armorTypeLength]][filtSet[e][armorTypeLength+1]].perk.j==indexPerk[h].j&&tempperk[h]--,j=0;j<armorTypeLength;j++)iarmor[j][filtSet[e][j]].perk.k==indexPerk[h].k&&iarmor[j][filtSet[e][j]].perk.j==indexPerk[h].j&&tempperk[h]--;for(h=0;h<indexPerkLength;h++){for(j=0;j<armorTypeLength;j++)iarmor[j][filtSet[e][j]].cell==indexPerk[h].j&&tempperk[h]>0&&0==l[j]&&(filtSetCells[e][j].j=indexPerk[h].j,filtSetCells[e][j].k=indexPerk[h].k,l[j]=!0,tempperk[h]--);5==indexPerk[h].j&&tempperk[h]>0&&0==l[armorTypeLength+2]&&(filtSetCells[e][armorTypeLength+2].j=indexPerk[h].j,filtSetCells[e][armorTypeLength+2].k=indexPerk[h].k,l[armorTypeLength+2]=!0,tempperk[h]--),legendaryWeapon?(tempperk[h]>0&&0==l[armorTypeLength]&&(filtSetCells[e][armorTypeLength].j=indexPerk[h].j,filtSetCells[e][armorTypeLength].k=indexPerk[h].k,l[armorTypeLength]=!0),tempperk[h]--,tempperk[h]>0&&0==l[armorTypeLength+1]&&(filtSetCells[e][armorTypeLength+1].j=indexPerk[h].j,filtSetCells[e][armorTypeLength+1].k=indexPerk[h].k,l[armorTypeLength+1]=!0,tempperk[h]--)):(iweapon[filtSet[e][armorTypeLength]][filtSet[e][armorTypeLength+1]].cell[0]==indexPerk[h].j&&tempperk[h]>0&&0==l[armorTypeLength]&&(filtSetCells[e][armorTypeLength].j=indexPerk[h].j,filtSetCells[e][armorTypeLength].k=indexPerk[h].k,l[armorTypeLength]=!0,tempperk[h]--),iweapon[filtSet[e][armorTypeLength]][filtSet[e][armorTypeLength+1]].cell[1]==indexPerk[h].j&&tempperk[h]>0&&0==l[armorTypeLength+1]&&(filtSetCells[e][armorTypeLength+1].j=indexPerk[h].j,filtSetCells[e][armorTypeLength+1].k=indexPerk[h].k,l[armorTypeLength+1]=!0,tempperk[h]--))}}for(let l=0;l<armorTypeLength;l++)12777==iarmor[l][filtSet[e][l]].id&&(r=!1,k.push(l));return 12777==iweapon[filtSet[e][armorTypeLength]][filtSet[e][armorTypeLength+1]].id&&(r=!1,k.push(armorTypeLength)),saveSet=0==r?{id:ExpandRecursivefiltSetelem([filtSet[e]],k),cell:filtSetCells[e]}:{id:[filtSet[e]],cell:filtSetCells[e]},saveSet.id.length>1&&null!=saveSet.id[0][0]&&(saveSet.id=saveSet.id.sort(sortFunction)),k.splice(0),r=!0,saveSet}var indexPerk,indexPerkRank,indexPerkLength,setWidth,armorTypeLength,weaponTypeLength,legendaryWeapon=!1,filtSetCount=0,filtSetLength=0,cacheSet=[],cacheSetCount=0,cacheSetLength=0,setCount=0,weaponLength=[],armorLength=[];self.onmessage=function(e){if(null!=e.data.indexPerk){for(indexPerk=e.data.indexPerk,indexPerkRank=e.data.indexPerkRank,indexPerkLength=indexPerk.length,legendaryWeapon=e.data.legendaryWeapon,lock=e.data.lock,setWidth=iarmor.length+3,armorTypeLength=iarmor.length,weaponTypeLength=iweapon.length,i=0;i<weaponTypeLength;i++)weaponLength.push(iweapon[i].length);for(i=0;i<armorTypeLength;i++)armorLength.push(iarmor[i].length);for(greenLight=!1,filtSetCells=[],filtSet=[],cacheSets=[],labelCount=0,search(indexPerk,indexPerkRank,lock),filtSetLength=filtSet.length,cacheSet=processFiltSetelem(filtSetCount),cacheSetLength=cacheSet.id.length,filtSetCount++,cacheSets.push(cacheSet),cacheSetCount++;filtSetCount<filtSetLength&&filtSetCount<100;)cacheSetCount=0,cacheSet=processFiltSetelem(filtSetCount),cacheSetLength=cacheSet.id.length-3,filtSetCount++,cacheSets.push(cacheSet),cacheSetCount++;this.postMessage(cacheSets),self.close()}};